<script src="props/props.component.ts"></script>
<div class="flex">
  <div class="tools">
    <app-tools (plugdata)="changePlugdata($event)"></app-tools>
  </div>
  <div class="full">
    <div class="canvas" #workspace (contextmenu)="onContextMenu($event)"></div>
    <div *ngIf="currentFile === 1" class="flex" style="height: 20px;margin-top: 25px;background-color: #8c8c8c;font-weight: bold" >
      <div class="item  flex" style="width: 16%;">
        控制系统
      </div>
      <div class="item  flex" style="width: 18%;">
        连接器
      </div>
      <div class="item  flex" style="width: 20%;">
        智能集线器
      </div>
      <div class="item  flex" style="width: 14%;">
        连接器
      </div>
      <div class="item  flex" style="width: 10%;">
        底层部件
      </div>
      <div class="item  flex" style="width: 23%;">
        备注
      </div>
    </div>
    <div class="flex  pt2" style="background-color: #242424;color: yellow" >
      <div style="width: 20%;" >
        文件名：
        <label *ngIf="!editFilename" (dblclick)="onEditFile(filenameInput)" title="双击编辑，点击空白保存">{{data.name}}</label>
        <form class="inline" [class.hidden]="!editFilename" #myForm="ngForm" [uiTouchForm]="myForm" title="双击编辑，点击空白保存">
          <input name="filename" #filenameInput class="input" [(ngModel)]="data.name" (blur)="onSaveFilename()"
                 required/>
        </form>
        <i class="iconfont icon-edit" *ngIf="!editFilename" (click)="onEditFile(filenameInput)" title="双击编辑，点击空白保存"></i>
      </div>
      <div style="width: 20%">
        文件描述：
        <label *ngIf="!editFiledesc" (dblclick)="onEditFileDesc(filedescInput)" title="双击编辑，点击空白保存">{{data.desc}}</label>
        <form class="inline" [class.hidden]="!editFiledesc" #myForm="ngForm" [uiTouchForm]="myForm" title="双击编辑，点击空白保存">
          <input name="filedesc" #filedescInput class="input" [(ngModel)]="data.desc" (blur)="onSaveFiledesc()"
                 required/>
        </form>
        <i class="iconfont icon-edit" *ngIf="!editFiledesc" (click)="onEditFileDesc(filedescInput)" title="双击编辑，点击空白保存"></i>
      </div>
      <div *ngIf="currentFile === 1" class="item  flex" style="width: 200px;">
        <a style="color:yellow;">增加模板</a>
        <div class="dropdown">
          <div class="item">
            <a (click)="newM8()">
              单通道M8
            </a>
          </div>
          <div class="item line"></div>
          <div class="item">
            <a >
              其他
            </a>
          </div>
        </div>
      </div>

      <div *ngIf="currentFile === 1" class="item  flex" style="width: 200px;">
        <a style="color:yellow;">删除模板</a>
        <div class="dropdown">
          <div class="item" *ngFor="let muban of report_list2">
            <a (click)="del_muban(muban.muban_id)">
              {{muban.muban_name}}
            </a>
          </div>
        </div>
      </div>

      <div *ngIf="currentFile === 1" class="item  flex" style="width: 200px;">
        <a style="color:yellow;">校验电流</a>
        <div class="dropdown">
          <div class="item" *ngFor="let muban of report_list2">
            <a (click)="jiaoyan(muban.muban_id)">
              {{muban.muban_name}}
            </a>
          </div>
          <div class="item line"></div>
          <div class="item">
            <a (click)="jiaoyanAll()">
              整个文件
            </a>
          </div>
        </div>
      </div>

<!--      <div *ngIf="data.id">-->
<!--        <a routerLink="/user/history" [queryParams]="{ id: data.id, name: data.name }">-> 文件历史</a>-->
<!--      </div>-->
    </div>


  </div>
  <div class="props" style="font-size: 12px;">
    <div class="pv5">
      <div *ngIf="!selected">
        <div class="group">
          <div style="font-weight: 600">画布设置</div>
          <div class="flex grid">
            <div>宽度（px）</div>
            <div>高度（px）</div>
          </div>
          <div class="flex grid mt5">
            <div class="mr5">
              <input type="number" name="x" class="input" [(ngModel)]="size.width" [uiMin]="0" [uiMax]="5000"
                     [readonly]="readonly" required (change)="changesize()" />
            </div>
            <div>
              <input type="number" name="y" class="input" [(ngModel)]="size.height" [uiMin]="0" [uiMax]="5000"
                     [readonly]="readonly" required (change)="changesize()" />
            </div>
          </div>
          <div>
            <div>画布颜色</div>
          </div>
          <div class="flex grid">
            <div class="mr5">
              <div class="input color" [class.readonly]="readonly">
                <i [(colorPicker)]="cavasbkColor" [style.background]="cavasbkColor" cpPosition="bottom"
                   cpAlphaChannel="always" cpOutputFormat="hex" [cpPresetColors]="cpPresetColors"
                   (colorPickerChange)="changebkColor()"></i>
                <input name="bkColor" [(ngModel)]="cavasbkColor" [readonly]="readonly"
                       (change)="changebkColor()" />
              </div>
            </div>
          </div>
        </div>
        <div class="group">
          <div style="font-weight: 600">
            <a (click)="showReport = true" >
            点击查看详细产品表单
          </a>
          </div>
          <table border="1px" bordercolor="#e7e27aff" >
            <thead >
            <tr style="background-color: #F8F8F8">
              <th>区域号</th>
              <th>区域名</th>
              <th>产品名</th>
            </tr>
            </thead>
            <tbody *ngFor="let list of report_list2" >
            <tr *ngFor="let node1 of list.report_nodes;index as i;">
              <td *ngIf="i === 0" [attr.rowspan]="list.report_nodes.length" >{{list.muban_id}}</td>
              <td *ngIf="i === 0"  [attr.rowspan]="list.report_nodes.length" >{{list.muban_name}}</td>
              <td style="padding: 10px 2px;">{{zh_en.get(node1.node_name)}}</td>
            </tr>
            </tbody>
          </table>
        </div>
<!--        <div class="group">-->
<!--          <div style="font-weight: 600" >树状结构-->
<!--          </div>-->
<!--          <div class="ml30 mb20 mt10">-->
<!--            <nz-demo-tree-line>loading</nz-demo-tree-line>-->
<!--          </div>-->

<!--        </div>-->
        <div class="group">
          <div style="font-weight: 600">
            小提示
          </div>
          <ul class="ml30 mb20 mt10">
            <li>方向键：控制节点移动5个像素</li>
            <li>Ctrl + 方向键：控制节点移动1个像素</li>
            <li>Ctrl + 鼠标移动：移动整个画布</li>
            <li>Ctrl + 鼠标滚轮：缩放</li>
            <li>添加或选中节点，右侧属性支持上传各种图片哦</li>
          </ul>
        </div>
      </div>
      <div *ngIf="selected">
        <app-props [props]="selected" [readonly]="readonly" (ok)="onChangeProps($event)"
                   (animateChange)="onAnimateChange()"></app-props>
      </div>
    </div>
  </div>
</div>

<div class="modal" *ngIf="showReport">
  <div class="modal-content">
    <div class="modal-header pointer" uiDivMove [isHead]="true">
      <div class="caption">报目表</div>
      <i class="fr iconfont icon-close" (click)="showReport = null"></i>
    </div>
    <div class="modal-body">


      <table border="1">
        <thead >
        <tr style="background-color: #e7e27aff">
          <th>区域号</th>
          <th>区域名</th>
          <th>产品名</th>
          <th>型号</th>
          <th>数量</th>
          <th>备注</th>
        </tr>
        </thead>
        <tbody *ngFor="let list of report_list2">
          <tr *ngFor="let node1 of list.report_nodes;index as i;">
            <td *ngIf="i === 0" [attr.rowspan]="list.report_nodes.length" >{{list.muban_id}}</td>
            <td *ngIf="i === 0"  [attr.rowspan]="list.report_nodes.length" >{{list.muban_name}}</td>
            <td>{{zh_en.get(node1.node_name)}}</td>
            <td>{{node1.node_type}}</td>
            <td>1</td>
            <td>{{node1.remarks}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="modal-footer">
      <button type="button" class="button" (click)="showReport = null">
        确定
      </button>
    </div>
  </div>
</div>

<div class="modal" *ngIf="showWindows" >
  <app-windows [current]="current" [jiekou]="jiekou" [leixing]="leixing" [jixing]="jixing" [xianzhi]="xianzhi" [desc]="desc" [name]="name"
               (changeShow)="changeShowWindows($event)" (setNodeData)="setNodeData($event)"></app-windows>
</div>




<app-context-menu [contextmenu]="contextmenu" [canvas]="canvas" [selNodes]="selNodes" [selected]="selected"
                  [locked]="locked"></app-context-menu>

